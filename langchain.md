---
title: "LangChain Agent åŸç†ä¸å·¥ä½œæœºåˆ¶"
description: "ç³»ç»Ÿè®²è§£ LangChain ä¸­ Agent çš„æ ¸å¿ƒç»“æ„ã€å·¥å…·è°ƒç”¨æœºåˆ¶ä¸ LLM äº¤äº’æµç¨‹ï¼Œå¸®åŠ©ç†è§£å…¶åœ¨æ™ºèƒ½ä½“æ¡†æ¶ä¸­çš„ä½œç”¨ã€‚"
pubDate: 2024-10-03
category: "theory"
tags: ["langchain", "agent", "llm", "tool-calling", "prompt-engineering"]
draft: false
---
---
# LangChain Agent åŸç†è¯¦è§£
LangChain Agent åŸç†è¯¦è§£
LangChain çš„ **Agentï¼ˆæ™ºèƒ½ä½“ï¼‰** æ˜¯ä¸€ç§èƒ½å¤Ÿè°ƒç”¨å¤–éƒ¨å·¥å…·ã€åŠ¨æ€è§„åˆ’ä»»åŠ¡æ­¥éª¤çš„æ™ºèƒ½è°ƒåº¦ç³»ç»Ÿã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š  
> è®© LLM ä¸ä»…èƒ½â€œå›ç­”é—®é¢˜â€ï¼Œè¿˜èƒ½â€œå†³å®šåšä»€ä¹ˆâ€ï¼Œå¹¶ä¸»åŠ¨è°ƒç”¨å‡½æ•°æˆ–å·¥å…·å®Œæˆå¤æ‚ä»»åŠ¡ã€‚

---

## ğŸ§© ä¸€ã€Agent çš„åŸºæœ¬ç»„æˆ

ä¸€ä¸ª LangChain Agent é€šå¸¸ç”±ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ç»„æˆï¼š

| ç»„ä»¶ | ä½œç”¨ |
|------|------|
| **LLM** | å¤§è¯­è¨€æ¨¡å‹ï¼Œç”¨äºæ¨ç†ã€è§„åˆ’ä»»åŠ¡æ­¥éª¤ã€‚ |
| **Tools** | å·¥å…·é›†åˆï¼Œæ¯ä¸ªå·¥å…·æ˜¯ä¸€ä¸ªå¯ä»¥è¢«è°ƒç”¨çš„å‡½æ•°ï¼Œå…·æœ‰åç§°ã€æè¿°å’Œå‚æ•°å®šä¹‰ã€‚ |
| **AgentExecutor** | æ‰§è¡Œè°ƒåº¦å™¨ï¼Œè´Ÿè´£å¾ªç¯åœ°è§£æ LLM çš„æ€è€ƒä¸åŠ¨ä½œï¼Œæ‰§è¡Œå·¥å…·å¹¶ç®¡ç†çŠ¶æ€ã€‚ |
| **Memoryï¼ˆå¯é€‰ï¼‰** | ç”¨äºè®°å½•ä¸Šä¸‹æ–‡ï¼Œæ”¯æŒå¤šè½®å¯¹è¯æˆ–ä»»åŠ¡è¿½è¸ªã€‚ |
äº¤äº’ç¤ºæ„å›¾
![alt text](2.png)

---

## âš™ï¸ äºŒã€Agent çš„è¿è¡ŒåŸç†

å½“ç”¨æˆ·å‘ Agent å‘é€è¯·æ±‚æ—¶ï¼Œæ•´ä¸ªæµç¨‹å¦‚ä¸‹ï¼š

1. **ç”¨æˆ·è¾“å…¥**
   - ç”¨æˆ·æå‡ºè‡ªç„¶è¯­è¨€ä»»åŠ¡ï¼ˆå¦‚â€œè¯·è¯»å– input.csv å¹¶å»æ‰ç©ºå€¼åˆ—â€ï¼‰ã€‚

2. **Agent æ„é€ æç¤ºï¼ˆPromptï¼‰**
   - Agent å°†ä»¥ä¸‹ä¿¡æ¯ä¸€å¹¶æ‰“åŒ…å‘é€ç»™ LLMï¼š
     - ç”¨æˆ·é—®é¢˜ï¼›
     - å¯ç”¨çš„å·¥å…·åˆ—è¡¨ï¼ˆåŒ…æ‹¬æ¯ä¸ªå·¥å…·çš„åç§°ã€æè¿°ã€å‚æ•°ï¼‰ï¼›
     - æŒ‡å®šè¾“å‡ºæ ¼å¼ï¼Œä¾‹å¦‚ï¼š
       ```
       Thought: ...
       Action: ...
       Action Input: ...
       ```

3. **LLM æ¨ç†**
   - LLM æ ¹æ®æç¤ºç”Ÿæˆä¸€æ®µç»“æ„åŒ–è¾“å‡ºï¼š
     ```
     Thought: æˆ‘éœ€è¦è¯»å–æ–‡ä»¶å†…å®¹
     Action: FilePreviewTool
     Action Input: "input.csv"
     ```

4. **Agent è§£æä¸æ‰§è¡Œ**
   - Agent è§£æå‡º `Action` å’Œ `Action Input`ï¼›
   - è°ƒç”¨å¯¹åº”çš„å·¥å…·å‡½æ•°ï¼›
   - è·å–å·¥å…·è¿”å›ç»“æœï¼ˆ`Observation`ï¼‰ã€‚

5. **åé¦ˆå¾ªç¯**
   - Agent å°†å·¥å…·æ‰§è¡Œç»“æœä¸å†å²ä¸Šä¸‹æ–‡æ‹¼æ¥ï¼›
   - å†æ¬¡å‘é€ç»™ LLMï¼Œè®©æ¨¡å‹æ€è€ƒä¸‹ä¸€æ­¥ï¼š
     ```
     Thought: æ–‡ä»¶è¯»å–æˆåŠŸï¼Œæˆ‘éœ€è¦ç”Ÿæˆæ¸…æ´—ä»£ç 
     Action: CodeGeneratorTool
     Action Input: "å»æ‰ç©ºå€¼åˆ—"
     ```

6. **è¿­ä»£æ‰§è¡Œ**
   - è¿™ä¸€è¿‡ç¨‹ä¼šä¸æ–­é‡å¤ï¼š
     - **LLM æ¨ç† â†’ å·¥å…·è°ƒç”¨ â†’ ç»“æœåé¦ˆ**
   - ç›´åˆ° LLM è¾“å‡ºï¼š
     ```
     Final Answer: æ–‡ä»¶å·²æˆåŠŸæ¸…æ´—å¹¶ä¿å­˜ä¸º output.csv
     ```

7. **Agent è¿”å›æœ€ç»ˆç»“æœ**
   - Agent æ£€æµ‹åˆ° `Final Answer`ï¼›
   - å°†ç»“æœè¾“å‡ºç»™ç”¨æˆ·ç«¯ã€‚
8. **ä¸€ä¸ªç®€å•çš„ä¾‹å­**
   - æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç®€å•çš„æ•°å­¦è¿ç®—å·¥å…·
     ```
      def add_numbers(expr: str) -> str:
          """è®¡ç®—ç®€å•ç®—å¼ï¼Œå¦‚ '5 + 7'"""
          try:
              result = eval(expr)
              return f"ç»“æœæ˜¯ {result}"
          except Exception as e:
              return f"é”™è¯¯: {e}"


      tools = [
          Tool(
              name="Calculator",
              func=add_numbers,
              description="ç”¨äºè®¡ç®—ç®€å•çš„æ•°å­¦è¡¨è¾¾å¼ï¼Œå¦‚ '5 + 7'ã€‚"
          )
      ]
     ```
   - ç„¶åè°ƒç”¨agentæ‰§è¡Œé—®é¢˜
     ```
       response = agent.run("è¯·è®¡ç®— 8 * 7 ç­‰äºå¤šå°‘ï¼Ÿ")
       print("\nâœ… æœ€ç»ˆå›ç­”:", response)
     ```
   - å›è°ƒæ‰“å°llmçš„è¾“å…¥ä¸è¾“å‡º
     ```
       class DeepSeekRequestLogger(BaseCallbackHandler):
      """æ˜¾ç¤º LLM å®é™… HTTP è¯·æ±‚çš„ headers + bodyã€‚"""

      def on_llm_start(self, serialized, prompts, **kwargs):
          print("\n====================== ğŸ›°ï¸ Agent å‘ DeepSeek å‘é€è¯·æ±‚ ======================")
          try:
              # æ‰“å° Prompt å†…å®¹ï¼ˆå³ messages çš„ user éƒ¨åˆ†ï¼‰
              print("ğŸ§¾ Prompt å†…å®¹:")
              print(json.dumps(prompts, ensure_ascii=False, indent=2, default=str))
          except Exception:
              pass
          print("=====================================================================\n")

      def on_llm_end(self, response, **kwargs):
          print("\n====================== ğŸ“¡ DeepSeek è¿”å›å“åº” ======================")
          print(str(response))
          print("=================================================================\n")
     ```
     å›è°ƒç»“æœ
     ![alt text](å›¾ç‰‡1.png)
     å¯ä»¥çœ‹åˆ°ç¬¬ä¸€æ¬¡è¯·æ±‚ï¼Œagentå°†ç”¨æˆ·é—®é¢˜ã€å¯ç”¨å·¥å…·åŠå…¶æè¿°ã€å›å¤æ ¼å¼å‘ç”Ÿç»™llmï¼Œç„¶ållmå°†åŠ¨ä½œå’Œå‚æ•°è¿”å›ç»™agent
     ![alt text](å›¾ç‰‡2.png)
     agentæ ¹æ®è¿”å›çš„å†…å®¹è°ƒç”¨å¯¹åº”å‡½æ•°ï¼Œå¹¶å°†ä¸Šä¸€æ­¥llmçš„åŠ¨ä½œå’Œæ‰§è¡Œå“åº”æ‹¼æ¥åˆ°ä¹‹å‰çš„promptä¸­å†å‘é€ç»™llmï¼Œllmæ ¹æ®å“åº”ï¼Œåˆ¤æ–­ä»»åŠ¡å·²ç»å®Œæˆï¼Œè¾“å‡ºfinal answerï¼Œagentæ”¶åˆ°final answerç»ˆæ­¢å¾ªç¯ï¼Œå°†æœ€ç»ˆç»“æœè¾“å‡ºç»™ç”¨æˆ·
---




